<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Currency Dropdown with Flags</title>
  <style>
    /* CSS Styling */
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    .dropdown-container {
      max-width: 400px;
      margin: auto;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
    }

    select {
      width: 20%;
      padding: 2px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 16px;
    }

    .flag {
      vertical-align: middle;
      margin-right: 8px;
      width: 24px;
      height: 18px;
    }
    
    .base-currency-dropmenu,
    .target-currency-dropmenu {
      display: flex;
      /* border: 2px solid red; */
      align-items: center;
      gap: 1vw;
      padding: 2vw;
      background-color: rgb(221, 221, 221);
      border-radius: 1vw;
    }

    .base-currency-dropmenu {
      margin-bottom: 10px;
    }

    .base-currency-dropmenu img,
    .target-currency-dropmenu img {
      border: 2px solid red;
      height: 100%;
    }
  </style>
</head>
<body>
  <div class="dropdown-container">
    <div class="base-currency-dropmenu">
    <span>BASE CURRENCY: </span>
    <img id="flagImg" src="" alt="">
    <select id="baseCurrency">
      <option value="PKR">  PKR</option>
    </select>
  </div>

    <div class="target-currency-dropmenu">
      <span>TARGET CURRENCY: </span>
      <img id ="flagImg2" src="" alt="">
      <select id="targetCurrency">
        <option value="PKR">  PKR</option>
      </select>
    </div>
  </div>

  <script>
    // Fetch the JSON data from the API
    const apiUrl = "https://flagcdn.com/en/codes.json";

    fetch(apiUrl)
      .then(response => response.json())
      .then(data => {
        // Process the data and populate the dropdowns
        populateDropdown("baseCurrency", data);
        populateDropdown("targetCurrency", data);
      })
      .catch(error => console.error("Error fetching currency data:", error));

    // Function to populate a dropdown with currency options and flags
    function populateDropdown(dropdownId, data) {
      const dropdown = document.getElementById(dropdownId);
      const dropdownValue = dropdownId;

      // Clear existing options
      dropdown.innerHTML = '<option value="">Select Currency</option>';

      // Iterate through the JSON data and create options
      Object.entries(data).forEach(([code, name]) => {
        const option = document.createElement("option");
        option.value = code;

        // Combine the flag image and text into the option label
        option.innerHTML = `${code.toUpperCase()}`; 

        // Append the option to the dropdown
        dropdown.appendChild(option);
      });

      dropdown.addEventListener('change', () => {
        const SelectedValue = dropdown.value;

        addFlag(SelectedValue, dropdownValue);
        console.log(`VALUE OF DROP DOWN IS ${SelectedValue.toUpperCase()}`);
      });
    }
    
    function addFlag(code, dropdownValue) {
      const flagUrl = `https://flagsapi.com/${code.toUpperCase()}/flat/64.png`;
      console.log(flagUrl);
      console.log(dropdownValue);

      if (dropdownValue === "baseCurrency") {
        const flagImage = document.getElementById("flagImg");
        flagImage.src = flagUrl;
      }
      
      if (dropdownValue === "targetCurrency") {
        const flagImage2 = document.getElementById("flagImg2");
        flagImage2.src = flagUrl;
      }
    }


    /* 
      // ALGORITHM
      1. We can check what dropdownId we have to serve a condition.
      2. If the condition is true for baseCurrency, then we will change the flag in baseCurrency.
      3. If the condition is true for targetCurrency, then we will change the flag in targetCurrency.

      Problem: We are getting all the dropdown options inside the dropValue in one instance. We need to find a way to make sure we only get what we want.

      Possibly, we could work with trying to distinguish one of the options, one way or the other.

      Solved: I used the dropdownId to disguish both dropdowns.
    */
  </script>
</body>
</html>